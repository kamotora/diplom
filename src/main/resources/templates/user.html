<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="https://www.thymeleaf.org"      xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="auto" class="h-100"><head>    <th:block th:replace="fragments/head :: head(${user.id} ?'Редактирование пользователя ' + ${user.username}    : 'Добавить пользователя')"/>    <meta name="_csrf" th:content="${_csrf.token}"/>    <meta name="_csrf_header" th:content="${_csrf.headerName}"/></head><body class="d-flex flex-column h-100"><header>    <div th:replace="fragments/navbars :: selectNavbar"></div></header><main role="main" class="flex-shrink-0">    <div class="container">        <div id="messages" th:replace="fragments/messages :: messages"></div>        <form th:object="${user}" th:action="@{/user}" th:method="post">            <div class="mb-3">                <h3 th:text="${user.id} ?'Редактирование пользователя ' + ${user.username} : 'Добавить пользователя'"></h3>            </div>            <input type="hidden" id="id" th:field="*{id}" readonly="readonly"/>            <div class="mb-3">                <label for="name">ФИО</label>                <input type="text" class="form-control" th:field="*{name}" th:errorclass="is-invalid" id="name"                       placeholder="" required="required"/>            </div>            <div class="mb-3">                <label for="number">Номер</label>                <input maxlength="11" type="tel" class="form-control" id="number" th:field="*{number}"                       th:errorclass="is-invalid" placeholder="Номер" required="required"/>                <div class="invalid-feedback">                    Неправильно введен Номер                </div>            </div>            <div class="mb-3">                <label for="username">Логин</label>                <div class="input-group">                    <div class="input-group-prepend">                        <span class="input-group-text">@</span>                    </div>                    <input type="text" class="form-control" id="username" th:field="*{username}"                           th:readonly="${user.id != null}" th:errorclass="is-invalid" placeholder="Логин" required="required"/>                </div>            </div>            <div class="mb-3">                <label for="password1">Пароль</label>                <span tabindex="0" data-toggle="tooltip"                      data-placement="top" title="Если пароль менять не надо, оставьте поля пустыми">                    <i class="far fa-question-circle"></i>                </span>                <input type="password" class="form-control" id="password1" th:field="*{password1}"                       th:errorclass="is-invalid" placeholder="Пароль" th:required="${user.id == null}"/>            </div>            <div class="mb-3">                <label for="password2">Повторите пароль</label>                <span tabindex="0" data-toggle="tooltip"                      data-placement="top" title="Если пароль менять не надо, оставьте поля пустыми">                    <i class="far fa-question-circle"></i>                </span>                <input type="password" class="form-control" id="password2" th:field="*{password2}"                       th:errorclass="is-invalid" placeholder="Повторите пароль" th:required="${user.id == null}"/>            </div>            <div class="mb-3">                <label for="email">Email <span class="text-muted">(Не обязательно)</span></label>                <input type="email" class="form-control" id="email" th:field="*{email}" th:errorclass="is-invalid"                       placeholder="you@example.com"/>            </div>            <div class="form-group mb-3">                <label for="roleSelect">Выберите роль</label>                <select class="form-control" id="roleSelect" th:field="*{role}" required="required">                    <option value="" th:selected="${user == null}">Выберите роль ...</option>                    <option th:each="optRole : ${allRoles}"                            th:value="${optRole}"                            th:text="${optRole.getAuthority()}"></option>                </select>            </div>            <div class="mb-3 form-group form-check">                <input id="active" th:field="*{active}" type="checkbox" class="form-check-input"/>                <label class=" form-check-label" for="active">Активирован</label>                <span tabindex="0" data-toggle="tooltip"                      data-placement="top"                      title="Неактивированные пользователи не смогут авторизоваться (в том числе по токену)"                >                    <i class="far fa-question-circle"></i>                </span>            </div>            <div class="form-group row" th:if="${user.id != null && #strings.isEmpty(user.token) == false}">                <label class="col-sm-1 col-form-label" for="token">Токен: </label>                <input type="text" class="col form-control-plaintext" size="64" id="token" th:field="*{token}"                       readonly="readonly"/>                <button class="btn btn-sm btn-outline-primary col-sm-3" type="button" onclick="regenerateToken()">                    Перегенерировать токен                </button>            </div>            <hr class="mb-4"/>            <button class="btn btn-lg btn-primary btn-block" type="submit">Сохранить</button>        </form>    </div></main><footer class="footer navbar-fixed-bottom mt-auto py-3" th:include="fragments/footer :: footer"></footer><script>    function regenerateToken() {        const id = $("#id").val();        const token = $("meta[name='_csrf']").attr("content");        const header = $("meta[name='_csrf_header']").attr("content");        if (id === undefined || id === "")            return;        $.ajax({            type: "GET",            url: "/user/" + id + "/change_token",            beforeSend: function (xhr) {                // here it is                xhr.setRequestHeader(header, token);            },            success: function (data) {                $("#token").val(data);            },            error: function (data) {            }        });    }</script></body></html>